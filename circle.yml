machine:
  pre:
    - curl -sSL https://s3.amazonaws.com/circle-downloads/install-circleci-docker.sh | bash -s -- 1.10.0
  services:
    - docker

dependencies:
  override:
    - docker login -e $DOCKER_EMAIL -u $DOCKER_USERNAME -p $DOCKER_PASS
    - docker pull yshrsmz/android
    - echo $JKS | base64 -d > ./monotweety.jks
    - echo $SECRETS | base64 -d > ./secret.properties
    - echo $GOOGLE_SERVICE_JSON | base64 -d > ./app/google-services.json

test:
  override:
    - echo $CIRCLE_BRANCH
    - docker run -v $(pwd):/monotweety -t yshrsmz/android /bin/bash /monotweety/scripts/ci.sh \
      -e CI_PULL_REQUEST \
      -e CIRCLE_PR_NUMBER \
      -e CIRCLE_PROJECT_USERNAME \
      -e CIRCLE_PROJECT_REPONAME \
      -e CIRCLE_SHA1 \
      -e CIRCLE_BRANCH \
      -e REVIEWDOG_GITHUB_API_TOKEN